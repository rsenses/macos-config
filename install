#!/bin/bash

# Script para instalar Xcode, Homebrew, Zsh, Tmux y Neovim

# Función para verificar si un paquete está instalado
check_package() {
  local package="$1"
  if ! command -v "$package" &> /dev/null; then
    echo "No se encuentra el paquete '$package'. Instalando..."
    if command -v xcode &> /dev/null; then
      echo "Xcode ya está instalado."
    else
      # Instalar Xcode
      echo "Instalando Xcode..."
      sudo xcode-select --install
      if [ $? -eq 0 ]; then
        echo "Xcode instalado correctamente."
      else
        echo "Error al instalar Xcode."
        exit 1
      fi
    fi
  fi
}

# Función para instalar un paquete usando Homebrew
install_package() {
  local package="$1"
  echo "Instalando '$package'..."
  brew install "$package"
  if [ $? -eq 0 ]; then
    echo "'$package' instalado correctamente."
  else
    echo "Error al instalar '$package'."
    exit 1
  fi
}

# --- Comprobación e instalación de Xcode ---
check_package "xcode"
if [ $? -eq 0 ]; then
  echo "Xcode ya está instalado. Pasando a la siguiente etapa."
else
  echo "Xcode no está instalado.  Instalando..."
  sudo xcode-select --install
  if [ $? -eq 0 ]; then
    echo "Xcode instalado correctamente."
  else
    echo "Error al instalar Xcode."
    exit 1
  fi
fi

# --- Comprobación e instalación de Homebrew ---
check_package "homebrew"
if [ $? -eq 0 ]; then
  echo "Homebrew ya está instalado. Pasando a la siguiente etapa."
else
  echo "Homebrew no está instalado.  Instalando..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
  if [ $? -eq 0 ]; then
    echo "Homebrew instalado correctamente."
  else
    echo "Error al instalar Homebrew."
    exit 1
  fi
fi

# --- Instalación de Zsh, Tmux y Neovim usando Homebrew Stow ---
echo "Instalando Zsh, Tmux y Neovim usando Homebrew Stow..."

# Instalar Zsh
install_package "zsh"
if [ $? -eq 0 ]; then
  echo "Zsh instalado correctamente."
else
  echo "Error al instalar Zsh."
  exit 1
fi

# Instalar Tmux
install_package "tmux"
if [ $? -eq 0 ]; then
  echo "Tmux instalado correctamente."
else
  echo "Error al instalar Tmux."
  exit 1
fi

# Instalar Neovim
install_package "neovim"
if [ $? -eq 0 ]; then
  echo "Neovim instalado correctamente."
else
  echo "Error al instalar Neovim."
  exit 1
fi

echo "Instalación completada."

stow -R nvim
stow -R wezterm
stow -R zsh
stow -R tmux
stow -R ghostty
stow -R sesh
stow -R git
stow -R editorconfig
stow -R bin
stow -R phpactor
